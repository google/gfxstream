load("@rules_cc//cc:defs.bzl", "cc_library")
load("//:build_variables.bzl", "GFXSTREAM_HOST_COPTS", "GFXSTREAM_HOST_DEFINES")

package(
    default_applicable_licenses = ["//:gfxstream_license"],
    default_visibility = ["//:gfxstream"],
)

cc_library(
    name = "gfxstream_host_openglesdispatch_headers",
    hdrs = [
        "include/OpenGLESDispatch/DispatchTables.h",
        "include/OpenGLESDispatch/EGLDispatch.h",
        "include/OpenGLESDispatch/GLESv1Dispatch.h",
        "include/OpenGLESDispatch/GLESv2Dispatch.h",
        "include/OpenGLESDispatch/OpenGLDispatchLoader.h",
        "include/OpenGLESDispatch/StaticDispatch.h",
    ],
    copts = GFXSTREAM_HOST_COPTS,
    defines = GFXSTREAM_HOST_DEFINES,
    includes = ["include"],
    textual_hdrs = [
        "include/OpenGLESDispatch/gldefs.h",
        "include/OpenGLESDispatch/gles_common_for_gles1_static_translator_namespaced_header.h",
        "include/OpenGLESDispatch/gles_common_for_gles2_static_translator_namespaced_header.h",
        "include/OpenGLESDispatch/gles_common_functions.h",
        "include/OpenGLESDispatch/gles_extensions_for_gles1_static_translator_namespaced_header.h",
        "include/OpenGLESDispatch/gles_extensions_for_gles2_static_translator_namespaced_header.h",
        "include/OpenGLESDispatch/gles_extensions_functions.h",
        "include/OpenGLESDispatch/gles_functions.h",
        "include/OpenGLESDispatch/gles1_extensions_functions.h",
        "include/OpenGLESDispatch/gles1_extensions_static_translator_namespaced_header.h",
        "include/OpenGLESDispatch/gles1_only_functions.h",
        "include/OpenGLESDispatch/gles1_only_static_translator_namespaced_header.h",
        "include/OpenGLESDispatch/gles12tr_internal.h",
        "include/OpenGLESDispatch/gles12tr.h",
        "include/OpenGLESDispatch/gles2_extensions_functions.h",
        "include/OpenGLESDispatch/gles2_extensions_static_translator_namespaced_header.h",
        "include/OpenGLESDispatch/gles2_only_functions.h",
        "include/OpenGLESDispatch/gles2_only_static_translator_namespaced_header.h",
        "include/OpenGLESDispatch/gles3_extensions_functions.h",
        "include/OpenGLESDispatch/gles3_extensions_static_translator_namespaced_header.h",
        "include/OpenGLESDispatch/gles3_only_functions.h",
        "include/OpenGLESDispatch/gles3_only_static_translator_namespaced_header.h",
        "include/OpenGLESDispatch/gles31_only_functions.h",
        "include/OpenGLESDispatch/gles31_only_static_translator_namespaced_header.h",
        "include/OpenGLESDispatch/gles32_only_functions.h",
        "include/OpenGLESDispatch/gles32_only_static_translator_namespaced_header.h",
        "include/OpenGLESDispatch/RenderEGL_extensions_functions.h",
        "include/OpenGLESDispatch/RenderEGL_extensions_static_translator_namespaced_header.h",
        "include/OpenGLESDispatch/RenderEGL_functions.h",
        "include/OpenGLESDispatch/RenderEGL_snapshot_functions.h",
        "include/OpenGLESDispatch/RenderEGL_snapshot_static_translator_namespaced_header.h",
        "include/OpenGLESDispatch/RenderEGL_static_translator_namespaced_header.h",
    ],
    deps = [
        "//third_party/opengl:gfxstream_gles2_headers",
        "//third_party/opengl:gfxstream_gles3_headers",
        "//third_party/opengl:gfxstream_gles_headers",
        "//third_party/opengl:gfxstream_glx_headers",
        "//third_party/opengl:gfxstream_opengl_headers",
    ],
)

cc_library(
    name = "gfxstream_host_openglesdispatch",
    srcs = [
        "EGLDispatch.cpp",
        "GLESv1Dispatch.cpp",
        "GLESv2Dispatch.cpp",
        "OpenGLDispatchLoader.cpp",
        "StaticDispatch.cpp",
        "gles1_stubbed_in_translator_namespace.cpp",
        "gles2_stubbed_in_translator_namespace.cpp",
    ],
    copts = GFXSTREAM_HOST_COPTS + [
        "-Wno-extern-c-compat",
    ],
    defines = GFXSTREAM_HOST_DEFINES,
    deps = [
        ":gfxstream_host_openglesdispatch_headers",
        "//host/decoder_common:gfxstream_host_decoder_common",
        "//host/gl:EGL_translator_static",
        "//third_party/opengl:gfxstream_gles2_headers",
        "//third_party/opengl:gfxstream_gles3_headers",
        "//third_party/opengl:gfxstream_gles_headers",
        "//third_party/opengl:gfxstream_glx_headers",
        "//third_party/opengl:gfxstream_opengl_headers",
    ],
)
